## To Run:

* Place a text PDF within the `books/` directory. To make it easier, rename it something that is easy to type such as, `pdf_name.pdf`
* Within the project root directory, run `./read pdf ${pdf_name.pdf}` in the terminal.
* App will extract the text from the pdf and give a rough estimate on the cost to convert to audio .mp3 file using Google TTS standard.
* Review and clean up the .txt file manually, erase any oddities that you don't want in your mp3 file.
* Activate the Google TTS / Audio container by running `./read speech pdf_name.pdf.txt` (the `pdf_name.pdf.txt` is a placeholder to later turn this into a full function). This will put you in the container shell after installing needed tools.
* With your cleaned up `pdf_name.pdf.txt` file, run `chunk_texts pdf_name.pdf.txt` to chunk the large text file that you manually cleaned up into 5000 or less byte chunks numbered `01.txt`, `02.txt` and so on in the directory `pdf_name`. This is necessary to make requests via Google TTS.
* Run `texttospeech pdf_name` on your designated text file. This will send requests to Google TTS and output individual files of the format `01.mp3`,`02.mp3`, etc. to the directory `audio/pdf_name`. Please see the section on Google TTS Quotas below for API usage.
* Finally you can string together all of the mp3s generated by running the command `string_together_mp3s pdf_name` which will place a final mp3 titled `audio/finalized/pdf_name.mp3` which will be a concatenation of all of the individual numbered mp3 files.

## About Google TTS Quotas

* As of writing this readme file, Google TTS imposes a 5000 bytes per request quota, and a 1000 requests per minute quota.
* Therefore:

```
(5000 bytes/request)(1000 requests/minute) = 5000000 bytes/minute = 5M bytes/minute
```

* If appropriately chunked, assuming there are 300,000 characters in a large document, this would suggest around 16 large documents per minute can be processed.
* That being said, the free tier of Google TTS is 1,000,000 or 1M bytes, so after 1M bytes there would be a cost per byte.
* Bytes are approximately equal to one character, accepting special characters which may be more than one byte, but our cost estimation function assumes incorrectly that 1 character = 1 byte.


[Google TTS Quotas](https://cloud.google.com/text-to-speech/quotas)


## SSML Reference Guide

https://cloud.google.com/text-to-speech/docs/ssml

## Known Errors in Google SSML

### Sentences Too Long

* The following type of error may arise:

`An error occurred: 400 This request contains sentences that are too long. Consider splitting up long sentences with sentence ending punctuation e.g. periods. Also consider removing SSML sentence tags (e.g. '<s>') as they can confuse Cloud Text-to-Speech.`

* We have put together `sentences_length` to analyze individual documents for sentences that might be too long. Run this on the document in question with, for example:

```
./sentences_length ../text/document_title/04.txt
```

* ...This will print out the length of each sentance via a simple regex function, demarcating sentances by `.`, `!` or `?`.

* Typically sentances with 500+ characters are too long for Google TTS.